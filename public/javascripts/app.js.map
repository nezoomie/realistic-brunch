{"version":3,"file":"public/javascripts/app.js","sources":["app/application.js","app/controllers/AppController.js","app/initialize.js","app/lib/view_helper.js","app/models/Config.js","app/models/collection.js","app/models/model.js","app/routers/AppRouter.js","app/views/AppLayout.js","app/views/HomeView.js","app/views/templates/appLayout.hbs","app/views/templates/home.hbs"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1KA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AALA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9DA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1BA;;A,CCAA;;AACA;AACA;AACA;AAHA;;A,CCAA;;AACA;AACA;AACA;AAHA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;;A","sourcesContent":["var App = Backbone.Marionette.Application.extend({\n  initialize: function(opts) {\n    var _this = this;\n    require('lib/view_helper');\n    this.setupConfig(opts);\n    \n    this.addInitializer(this.setupCommonModules);\n    this.addInitializer(this.extendBackbone);     \n    this.addInitializer(this.extendAjax);\n    this.addInitializer(this.mobileFixes);\n    this.addInitializer(this.bindAppEvents);\n    this.addInitializer(function(options) {\n      Backbone.history.start(); \n      return typeof Object.freeze === \"function\" ? Object.freeze(this) : void 0;\n    });\n    \n    this.setupLocale().done(function() {_this.start();});\n  },\n  \n  extendBackbone: function(options) {\n    var _this = this;\n    // Extend models to support resource nesting\n    _.extend(Backbone.Model.prototype, {\n      context: null,\n      urlPath: '',\n      url: function(){\n        return _([_this.config.get('apiUrl'), this.getPartialUrl()])\n            .compact()\n            .join('/');\n      },\n      getPartialUrl: function() {\n        var context = this.collection ? this.collection.context : this.context,\n            basePath = context ? context.getPartialUrl() : '';\n\n        return _([basePath, this.urlRoot || '', this.id || ''])\n            .compact()\n            .join('/');\n      }\n    });\n    \n    // Extend collections to support resource nesting\n    _.extend(Backbone.Collection.prototype, {\n      context: null,\n      urlPath: '',\n      url: function(){\n        return _([_this.config.get('apiUrl'), this.getPartialUrl()])\n            .compact()\n            .join('/');\n      },\n      getPartialUrl: function() {\n        var basePath = this.context ? this.context.getPartialUrl() : '';\n        return _([basePath, this.urlRoot || ''])\n          .compact()\n          .join('/');\n      }\n    });\n  },\n  \n  setupLocale: function(options) {\n    var language = this.config.get('languages').standard,\n        deferred = i18n.init({\n          preload: ['dev'],\n          lng: language,\n          fallbackLng: 'dev',\n          getAsync: true\n        }, function() {\n          moment.lang(i18n.lng());\n        });\n        \n      return deferred;\n  },\n  \n  setLocale: function(locale) {\n    if(i18n.lng() == locale)\n        return;\n  \n    i18n.setLng(locale);\n    moment.lang(locale);\n    this.layout.render();\n  },\n  \n  setupConfig: function(options) {\n    var Config = require('models/Config');\n    this.config = new Config();\n    this.parseOptions(this.initOptions);\n  },\n  \n  setupCommonModules: function(options) {\n    require('lib/view_helper');\n    // Set up the Layout\n    var AppRouter = require('routers/AppRouter'),\n        AppLayout = require('views/AppLayout');\n        \n    this.routers = {\n      app: new AppRouter()\n    };\n    \n    this.layout = new AppLayout({el: this.config.get('el')});\n    this.layout.render();\n  },\n  \n  extendAjax: function(options) {\n    var _this = this;\n    // Add custom headers\n    $.ajaxSetup({\n      headers : _this.config.get('HTTPheaders')\n    });\n    \n    // Handle default errors\n    $(document).ajaxError(function(event, jqXHR, ajaxSettings, thrownError) {\n      var status = jqXHR.statusCode().status;\n      if (status >= 500) {\n        _this.vent.trigger('flash:message', {\n          'text' : i18n.t('errors.internal_server_error'),\n          'type' : 'error'\n        });\n\n        _this.vent.trigger('navigate:home');\n      }\n    });\n  },\n  \n  bindAppEvents: function() {\n    var _this = this;\n    \n    this.vent.on({\n      'title:change': function(data) {\n        if (!_(data).isArray()) data = [data];\n        _this.changeTitle(data);\n      },\n    });\n  },\n  \n  mobileFixes: function(options) {\n    // Start FastClick library on touch devices\n    window.addEventListener('load', function() {\n      FastClick.attach(document.body);\n    }, false);\n  },\n  \n  changeTitle: function(elements) {\n    var options = this.config.get('title'), title;\n    title = _([ _(elements).compact().join(options.subSeparator), options.base ])\n            .compact().join(options.separator);\n            \n    document.title = title;\n  },\n  \n  parseOptions: function(options) {\n    // If the option is an object, extend configuration defaults, otherwise\n    // replaces it.\n    LOG('-> '+this.config.get('_NAME')+' v' + this.config.get('_VERSION'));\n    _.each(options, function(option, name) {\n      var mergedOption = option;\n      if (_(option).isObject() && !_(option).isArray()) {\n        LOG('-> Config: setting '+name+' to:');\n        LOG(option);\n        var defaults = this.config.get(name);\n        var mergedOption = $.extend(true,{},defaults,option);\n      }\n\n      this.config.set(name,mergedOption);\n    },this);\n\n    LOG('-> Config: merged configuration:');\n    LOG(this.config.attributes);\n  }\n});\n\nmodule.exports = new App();\n","var app = require('application'),\n    HomeView = require('views/HomeView');\n\nvar AppController = {\n  home: function(){\n    var homeView = new HomeView();\n    app.layout.content.show(homeView);\n    app.vent.trigger('title:change',[i18n.t('home.title')]);    \n  }\n};\n\napp.vent.on({\n  'navigate:home' : function(){\n    Backbone.history.navigate('home', {trigger:false});\n    AppController.home();\n  }\n});\n\nmodule.exports = AppController;","var app = require('application')\n\n$(document).ready(function() {\n  app.initialize();\n});\n","var app = require('application');\n// Put your handlebars.js helpers here.\n\n// Basic i18next handlebars helper\n// Usage:\n//\n// {{t \"my.key\" }}\n\nHandlebars.registerHelper('t', function(key) {\n    var result = i18n.t(key);\n    return new Handlebars.SafeString(result);\n});\n\n// Get translation from context\n// Usage:\n//\n// {{t_context key=\"my.key\" context=\"contex.to.index\" }}\n\nHandlebars.registerHelper('t_context', function(options) {\n  var key =  _.isFunction(options.hash.key) ? options.hash.key() : options.hash.key,\n      table = options.hash.context,\n      result = i18n.t([table,key].join('.'));\n\n  return new Handlebars.SafeString(result);\n});\n\n// Extended i18next handlebars helper\n// Usage:\n//\n// {{tr key=\"trans.sample.handlebarsExtended\" add=\"from helper\" }}\n\nHandlebars.registerHelper('tr', function(options) {\n    var opts = i18n.functions.extend(options.hash, this);\n    if (options.fn) opts.defaultValue = options.fn(this);\n    var result = i18n.t(opts.key, opts);\n    return new Handlebars.SafeString(result);\n});\n\n// Format date/time according to the current Locale\n// Usage:\n//\n// {{time value=dateToFormat}}\n// \n// additional formats can be specified in `models/Config`:\n//\n//  dateFormats: {\n//    standard: 'MMMM Do YYYY',\n//    myCustomFormat: 'MM yy'\n//  }\n//\n// and then used:\n//\n// {{ time value=dateToFormat format=\"myCustomFormat\" }}\n\nHandlebars.registerHelper('time', function(options) {\n  LOG(options.hash.value);\n    var value = options.hash.value,\n        dateFormats = app.config.get('dateFormats'),\n        format = options.hash.format || 'standard',\n        result = moment(value).format(dateFormats[format]);\n        \n    return new Handlebars.SafeString(result);\n});","var Model = require('models/model');\n\n// Include all app-wise configuration data here.\n \nmodule.exports = Model.extend({\n  defaults: {\n    _NAME: 'My Single Page App',\n    _VERSION: '0.1',\n    apiUrl: '',\n    el: 'body',\n    title: {\n      base: \"My Single Page App\",\n      separator: \" | \",\n      subSeparator: \" - \"\n    },\n    languages: {\n      standard: 'en'\n    },\n    dateFormats: {\n      standard: 'MMMM Do YYYY'\n    },\n    HTTPheaders:{\n      // Add custom HTTP headers here\n    }, \n  }\n});\n","// Base class for all collections.\n\nmodule.exports = Backbone.Collection.extend({});\n","// Base class for all models.\n\nmodule.exports = Backbone.Model.extend({});\n","module.exports = Backbone.Marionette.AppRouter.extend({\n  controller: require('controllers/AppController'),\n  appRoutes: {\n    '' : 'home'\n  }\n});\n","var app = require('application');\n\nmodule.exports = Backbone.Marionette.Layout.extend({\n  template: 'views/templates/appLayout',\n  \n\tel: 'body',\n\n\tregions: {\n    content: '#content' \n\t}\n});\n","module.exports = Backbone.Marionette.ItemView.extend({\n  id: 'home-view',\n  \n\ttemplate: 'views/templates/home',\n\t\n\ttemplateHelpers: {\n\t  now: new Date()\n\t}\n});\n","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"navbar navbar-fixed-top\\\">\\n  <div class=\\\"navbar-inner\\\">\\n    <div class=\\\"container\\\">\\n      <a class=\\\"brand\\\" href=\\\"#\\\">\";\n  options = {hash:{},data:data};\n  buffer += escapeExpression(((stack1 = helpers['t'] || depth0['t']),stack1 ? stack1.call(depth0, \"home.title\", options) : helperMissing.call(depth0, \"t\", \"home.title\", options)))\n    + \"</a>\\n    </div>\\n  </div>\\n</div>\\n\\n<div id=\\\"content\\\" class=\\\"container\\\"></div>\\n\";\n  return buffer;\n  });","module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"row\\\">\\n  <div class=\\\"span12\\\">\\n    \";\n  options = {hash:{\n    'value': (depth0.now)\n  },data:data};\n  buffer += escapeExpression(((stack1 = helpers.time || depth0.time),stack1 ? stack1.call(depth0, options) : helperMissing.call(depth0, \"time\", options)))\n    + \"\\n    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\\n  </div>\\n</div>\\n\\n    \";\n  return buffer;\n  });"]}